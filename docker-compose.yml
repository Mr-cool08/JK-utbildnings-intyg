version: '3.9'
services:
  app:
    build: .
    ports:
      # App lyssnar på 8080 i containern -> mappa värdens port 80 till 8080
      - "80:8080"
    env_file:
      - .env
    environment:
      DB_PATH: /data/database.db
      # Uncomment nedan om du vill aktivera TLS via miljövariabler (appens stöd)
      # CLOUDFLARE_CERT_PATH: /home/client_52_3/certs/cert.pem
      # CLOUDFLARE_KEY_PATH: /home/client_52_3/certs/key.pem
    volumes:
      - env_data:/config
      - uploads_data:/app/uploads
      - db_data:/data
      - logs_data:/app/logs

      # Behåll original mount till hemkatalogens certs (read-only rekommenderas)
      - /home/client_52_3/certs:/home/client_52_3/certs:ro

      # EXTRA mount till /certs så Gunicorn hittar /certs/cert.pem (read-only)
      - /home/client_52_3/certs:/certs:ro

volumes:
  env_data:
    name: env_data
  uploads_data:
    name: uploads_data
  db_data:
    name: db_data
  logs_data:
    name: logs_data
