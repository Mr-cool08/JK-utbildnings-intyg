{% extends 'base.html' %}
{% block title %}Översikt{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}
{% block content %}
<section class="dashboard">
    <h1>
        {% if user_name %}
            Hej {{ user_name }}! Här är dina intyg.
        {% else %}
            Hej! Här är dina intyg.
        {% endif %}
    </h1>
    {% if category_summary %}
    <section class="category-list" aria-label="Tillgängliga kurskategorier">
        <h2>Kurskategorier</h2>
        <ul>
            {% for category in category_summary %}
            <li>
                <span class="category-label">{{ category.label }}</span>
                <span class="category-count-badge">{{ category.count }} intyg</span>
            </li>
            {% endfor %}
        </ul>
    </section>
    {% endif %}

    {% if grouped_pdfs %}
    <section class="category-groups" aria-label="Intyg sorterade efter kategori">
        {% for group in grouped_pdfs %}
        <article class="category-group">
            <header class="category-header">
                <h3>{{ group.label }}</h3>
                <p class="category-count">{{ group.pdfs | length }} intyg</p>
            </header>
            <ul class="pdf-list">
                {% for pdf in group.pdfs %}
                <li data-pdf-categories="{{ pdf.categories | join(',') }}">
                    <a href="{{ url_for('download_pdf', pdf_id=pdf.id) }}" download>
                        {{ pdf.filename }}
                    </a>
                    <span class="pdf-meta">
                        <strong>Kategorier:</strong>
                        {% if pdf.category_labels %}
                            {{ pdf.category_labels | join(', ') }}
                        {% else %}
                            Inte angiven
                        {% endif %}
                        <br>

                    </span>
                    <div class="pdf-actions">
                        <button
                            type="button"
                            class="share-button"
                            data-share-button
                            data-pdf-id="{{ pdf.id }}"
                            data-pdf-name="{{ pdf.filename }}"
                        >
                            Dela via e-post
                        </button>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </article>
        {% endfor %}
    </section>
    {% else %}
    <p>Inga PDF:er uppladdade.</p>
    {% endif %}
</section>

<div id="shareModal" class="share-modal" aria-hidden="true">
    <div class="share-modal__backdrop" data-share-close></div>
    <div class="share-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="shareModalTitle">
        <button type="button" class="share-modal__close" aria-label="Stäng delningsrutan" data-share-close>&times;</button>
        <h2 id="shareModalTitle">Dela intyg via e-post</h2>
        <p class="share-modal__lead">
            Du delar <strong id="shareDocumentName">intyget</strong>. Ange mottagarens e-postadress nedan.
        </p>
        <form id="shareForm" class="share-form" novalidate>
            <label for="shareRecipientEmail">Mottagarens e-postadress</label>
            <input
                type="email"
                id="shareRecipientEmail"
                name="recipient_email"
                required
                autocomplete="email"
                placeholder="namn@example.se"
            >
            <button type="submit" class="share-submit">Skicka intyget</button>
        </form>
        <p class="share-modal__feedback" id="shareFeedback" role="alert" hidden></p>
    </div>
</div>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
