{% extends 'base.html' %}
{% block title %}Ansök om företagskonto – Utbildningsintyg{% endblock %}
{% block head %}
    <meta name="description" content="Ansök om företagskonto och få tillgång till Utbildningsintygets företagsportal.">
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/form_error_highlight.js') }}" defer></script>
{% endblock %}
{% block content %}
<section class="apply-hero" aria-labelledby="apply-title">
    <div class="apply-hero-content">

        <a class="back-link" href="{{ url_for('apply_account') }}" aria-label="Tillbaka till kontovalet">&#x2190; Tillbaka</a>
        <p></p>
        <div class="apply-intro">
            <h1 id="apply-title">Ansök om företagskonto</h1>
            <p>Som företagskonto får du administrera användarkonton, följa upp intyg och hantera fakturering.</p>
        </div>
        <form method="post" class="apply-form" novalidate>
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            {% if form_errors %}
                <div class="message error" role="alert">
                    <ul>
                        {% for error in form_errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            {% set name_error = field_errors.get('name') %}
            <label for="name">Fullständigt namn</label>
            <input
                id="name"
                name="name"
                type="text"
                value="{{ form_data.name }}"
                required
                autocomplete="name"
                class="{% if name_error %}input-error{% endif %}"
                aria-invalid="{{ 'true' if name_error else 'false' }}"
            >

            {% set email_error = field_errors.get('email') %}
            <label for="email">E-postadress</label>
            <input
                id="email"
                name="email"
                type="email"
                value="{{ form_data.email }}"
                required
                autocomplete="email"
                class="{% if email_error %}input-error{% endif %}"
                aria-invalid="{{ 'true' if email_error else 'false' }}"
            >

            {% set company_error = field_errors.get('company_name') %}
            <label for="company_name">Företag</label>
            <input
                id="company_name"
                name="company_name"
                type="text"
                value="{{ form_data.company_name }}"
                required
                autocomplete="organization"
                class="{% if company_error %}input-error{% endif %}"
                aria-invalid="{{ 'true' if company_error else 'false' }}"
            >

            {% set orgnr_error = field_errors.get('orgnr') %}
            <label for="orgnr">Organisationsnummer</label>
            <input
                id="orgnr"
                name="orgnr"
                type="text"
                inputmode="numeric"
                pattern="[0-9-\s]{6,12}"
                value="{{ form_data.orgnr }}"
                required
                placeholder="Exempel: 556016-0680"
                class="{% if orgnr_error %}input-error{% endif %}"
                aria-invalid="{{ 'true' if orgnr_error else 'false' }}"
                aria-describedby="orgnr-hint{% if orgnr_error %} orgnr-error{% endif %}"
            >
            <small class="hint" id="orgnr-hint">Ange organisationsnumret med eller utan bindestreck.</small>
            {% if orgnr_error %}
                <p class="field-error-message" id="orgnr-error">Kontrollera organisationsnumret och försök igen.</p>
            {% endif %}

            <fieldset class="field-group" id="invoiceSection">
                <legend>Faktureringsuppgifter</legend>
                {% set invoice_address_error = field_errors.get('invoice_address') %}
                <label for="invoice_address">Fakturaadress</label>
                <textarea
                    id="invoice_address"
                    name="invoice_address"
                    rows="3"
                    required
                    class="{% if invoice_address_error %}input-error{% endif %}"
                    aria-invalid="{{ 'true' if invoice_address_error else 'false' }}"
                >{{ form_data.invoice_address }}</textarea>
                <small class="hint">Ange fullständig adress inklusive eventuell referens.</small>

                {% set invoice_contact_error = field_errors.get('invoice_contact') %}
                <label for="invoice_contact">Kontaktperson</label>
                <input
                    id="invoice_contact"
                    name="invoice_contact"
                    type="text"
                    value="{{ form_data.invoice_contact }}"
                    required
                    class="{% if invoice_contact_error %}input-error{% endif %}"
                    aria-invalid="{{ 'true' if invoice_contact_error else 'false' }}"
                >

                {% set invoice_reference_error = field_errors.get('invoice_reference') %}
                <label for="invoice_reference">Märkning</label>
                <input
                    id="invoice_reference"
                    name="invoice_reference"
                    type="text"
                    value="{{ form_data.invoice_reference }}"
                    required
                    class="{% if invoice_reference_error %}input-error{% endif %}"
                    aria-invalid="{{ 'true' if invoice_reference_error else 'false' }}"
                >
            </fieldset>

            {% set comment_error = field_errors.get('comment') %}
            <label for="comment">Extra information <span class="optional">(valfritt)</span></label>
            <textarea
                id="comment"
                name="comment"
                rows="4"
                class="{% if comment_error %}input-error{% endif %}"
                aria-invalid="{{ 'true' if comment_error else 'false' }}"
            >{{ form_data.comment }}</textarea>

            {% set terms_error = field_errors.get('terms_confirmed') %}
            <div class="form-consent">
                <input
                    id="terms_confirmed"
                    name="terms_confirmed"
                    type="checkbox"
                    value="1"
                    {% if form_data.terms_confirmed %}checked{% endif %}
                    required
                    class="{% if terms_error %}input-error{% endif %}"
                    aria-invalid="{{ 'true' if terms_error else 'false' }}"
                >
                <label for="terms_confirmed">
                    Jag har läst och förstått <a href="{{ url_for('terms_of_service') }}">användarvillkoren</a> och
                    <a href="{{ url_for('gdpr_info') }}">GDPR-policyn</a>.
                </label>
            </div>

            <button type="submit" class="btn">Skicka ansökan</button>
        </form>
    </div>
</section>

<section class="apply-info" aria-labelledby="info-title">
    <h2 id="info-title">Om företagskonton</h2>
    <p class="apply-price">Företagsportalen kostar 20 kronor per anslutet användarkonto.</p>
    <p>Vid godkänd ansökan skapar vi företaget och kopplar nya användarkonton efter dina instruktioner.</p>
</section>

<section class="apply-steps" aria-labelledby="steps-title">
    <h2 id="steps-title">Så går ansökan till</h2>
    <ol class="apply-step-list">
        <li>
            <h3>Skicka in uppgifter</h3>
            <p>Beskriv företaget, faktureringsuppgifter och vem som ska vara huvudkontakt.</p>
        </li>
        <li>
            <h3>Verifiering</h3>
            <p>Vi kontrollerar organisationsnumret och förbereder företagsportalen.</p>
        </li>
        <li>
            <h3>Starta upp</h3>
            <p>När ansökan godkänns skickar vi bekräftelse, avtal och inloggningsinstruktioner.</p>
        </li>
    </ol>
</section>
{% endblock %}
