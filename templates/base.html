<!DOCTYPE html>
<html lang="sv">
<head>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VDVK18WVGT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-VDVK18WVGT');
    </script>

    <link rel="icon" type="image/png" href="{{ url_for('static', filename='pictures/favicon_smaller.png') }}">
    <meta charset="UTF-8">
    <title>{% block title %}Utbildningsintyg{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#E93B56">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    {% block head %}{% endblock %}
</head>
<body>
    <a class="skip-link" href="#main-content">Hoppa till innehåll</a>
    <nav class="site-nav">
        <div class="nav-inner">
            <a class="brand" href="/">
                <img class="brand-logo" src="{{ url_for('static', filename='pictures/favicon_smaller.png') }}" alt="JK Utbildnings logotyp">
                <span class="brand-name">Utbildningsintyg</span>
            </a>
            <button class="nav-toggle" type="button" aria-expanded="false" aria-label="Växla navigering">
                <span class="nav-toggle-bar"></span>
                <span class="nav-toggle-bar"></span>
                <span class="nav-toggle-bar"></span>
            </button>
            <div class="nav-links">
                {% if session.get('supervisor_logged_in') %}
                    <a href="{{ url_for('supervisor_dashboard') }}">Företagskontopanel</a>
                    <a href="/logout">Logga ut</a>
                {% elif session.get('user_logged_in') %}
                    <a href="/dashboard">Intyg</a>
                    <a href="/logout">Logga ut</a>
                {% elif session.get('admin_logged_in') %}
                    <a href="/admin">Admin</a>
                    <a href="/logout">Logga ut</a>
                {% else %}
                    <a class="nav-link {% if request.path == '/' %}is-active{% endif %}" href="/">Hem</a>
                    <a class="nav-link {% if request.path.startswith('/ansok') %}is-active{% endif %}" href="{{ url_for('apply_account') }}">Ansök om konto</a>
                    <a class="nav-link {% if request.path.startswith('/foretagskonto') %}is-active{% endif %}" href="{{ url_for('supervisor_login') }}">Företagsportal</a>
                    <a class="nav-link {% if request.path.startswith('/login') %}is-active{% endif %}" href="/login">Logga in</a>
                {% endif %}

            </div>
        </div>
    </nav>
    {% if IS_DEMO %}
        <div class="demo-banner" role="status">
            <strong>Demomiljö:</strong> Denna sajt använder en tillfällig databas och är endast avsedd för visning.
        </div>
    {% endif %}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="toast-container" aria-live="polite" aria-atomic="true">
                {% for category, message in messages %}
                    <div class="toast {{ category }}" role="status">
                        <div class="toast-message">{{ message }}</div>
                        <button class="toast-close" aria-label="Stäng meddelande">×</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    <main id="main-content">
        {% block content %}{% endblock %}
    </main>
    <footer class="site-footer">
        <div class="footer-inner">
            {% block footer %}Liam Suorsa © 2025{% endblock %}
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/nav.js') }}" defer></script>
    <style>
    /* Minimal toast styles kept local so template works without touching global CSS */
    .toast-container {
        position: fixed;
        right: 1rem;
        bottom: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        z-index: 1000;
        pointer-events: none;
    }
    .toast {
        pointer-events: auto;
        min-width: 220px;
        max-width: 360px;
        background: #222;
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 6px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.25);
        display: flex;
        align-items: center;
        justify-content: space-between;
        opacity: 0;
        transform: translateY(8px);
        transition: opacity 220ms ease, transform 220ms ease;
    }
    .toast.show {
        opacity: 1;
        transform: translateY(0);
    }
    .toast.success { background: #1b8f4a; }
    .toast.error { background: #d64545; }
    .toast .toast-message { margin-right: 0.5rem; flex: 1 1 auto; }
    .toast .toast-close {
        background: transparent;
        border: none;
        color: rgba(255,255,255,0.9);
        font-size: 1.1rem;
        line-height: 1;
        cursor: pointer;
        padding: 0 0.25rem;
    }
    </style>

    <script>
    // Small script to show toasts and auto-hide them. Runs immediately — degrades gracefully if JS disabled.
    (function(){
        function initToasts(){
            var container = document.querySelector('.toast-container');
            if(!container) return;
            var toasts = Array.prototype.slice.call(container.querySelectorAll('.toast'));
            toasts.forEach(function(t){
                // expose visually
                requestAnimationFrame(function(){ t.classList.add('show'); });
                // auto hide after 4s
                var hideTimer = setTimeout(function(){ hideToast(t); }, 4000);
                // allow manual close
                var btn = t.querySelector('.toast-close');
                if(btn){
                    btn.addEventListener('click', function(){ clearTimeout(hideTimer); hideToast(t); });
                }
            });
        }
        function hideToast(t){
            t.classList.remove('show');
            // remove from DOM after transition
            t.addEventListener('transitionend', function(){ if(t.parentNode) t.parentNode.removeChild(t); });
        }
        if(document.readyState === 'loading'){
            document.addEventListener('DOMContentLoaded', initToasts);
        } else {
            initToasts();
        }
    })();
    </script>
</body>
</html>
